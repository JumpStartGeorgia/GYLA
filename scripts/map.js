function map_init(){map=new OpenLayers.Map("map",{controls:[],restrictedExtent:new OpenLayers.Bounds(options.boundsLeft,options.boundsBottom,options.boundsRight,options.boundsTop)});base=new OpenLayers.Layer.OSM("Georgia","http://tile.openstreetmap.org/${z}/${x}/${y}.png",{numZoomLevels:19});base.setOpacity(0);layer=new OpenLayers.Layer.GML("Districts",baseurl+"events/districts",{format:OpenLayers.Format.GeoJSON,styleMap:map_styles()});var e=new OpenLayers.Control.SelectFeature(layer,{hover:true,onSelect:function(e){var t=['<b style="font-weight: bold;">'+e.attributes.name_2_geo+"</b> - "],n=e.attributes.event,r="";t+=n.length>0?"მოვლენები: "+n.length:"არ არის მოვლენები";$("#map-info").html(t).show(0)},onUnselect:function(){$("#map-info").hide(0,function(){$(this).text("")})},clickFeature:function(e){var t=e.attributes.event,n="";for(i in t){if(typeof t[i].id=="undefined"||t[i].id==null){continue}n+='<div class="switch"><a href="'+baseurl+"events/view/"+t[i].id+'">'+t[i].name+", "+" "+t[i].district_name+", "+t[i].start_at+"</a></div>"}$("#map_events").html(n)}});map.addControl(e);e.activate();map.addLayers([base,layer]);map.setCenter(new OpenLayers.LonLat(options.lon,options.lat));map.zoomTo(options.zoom)}function map_styles(){var e=new OpenLayers.Style,t=[],n="proportion",r=[{from:0,to:16,color:"9183B5"},{from:16,to:33,color:"7A6DA0"},{from:33,to:50,color:"64588C"},{from:50,to:66,color:"4D4277"},{from:66,to:82,color:"372D63"},{from:82,to:100,color:"21184F"}],i=OpenLayers.Filter.Comparison.GREATER_THAN;t.push(new OpenLayers.Rule({filter:new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:n,value:0})]}),symbolizer:{Polygon:{fillColor:"#beaede",strokeColor:"#fff",strokeWidth:1,fillOpacity:1}}}));for(var s in r){if(s>0)i=OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO;t.push(new OpenLayers.Rule({filter:new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[new OpenLayers.Filter.Comparison({type:i,property:n,value:parseInt(r[s].from)}),new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:n,value:parseInt(r[s].to)})]}),symbolizer:{Polygon:{fillColor:"#"+r[s].color,strokeColor:"#fff",fillOpacity:1}}}))}e.addRules(t);return new OpenLayers.StyleMap({"default":e,select:{strokeColor:"#fff",fillColor:"#9183B5",strokeWidth:0,fillOpacity:.9}})}var map,base,layer,options={boundsLeft:4260630.1231925,boundsBottom:4999230.0089212,boundsRight:5422472.9529191,boundsTop:5427277.3672416,zoom:7,lat:42.236652,lon:43.59375}
